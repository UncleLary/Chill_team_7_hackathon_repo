<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Learning App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            height: calc(100vh - 40px);
        }

        .questions-panel {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .questions-list {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .question-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .question-item:hover {
            background-color: #f9f9f9;
        }

        .checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .question-text {
            flex: 1;
            font-size: 14px;
            color: #333;
        }

        .progress-bar {
            width: 100px;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: #4caf50;
            transition: width 0.3s ease;
        }

        .delete-btn {
            width: 24px;
            height: 24px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-btn:hover {
            background-color: #d32f2f;
        }

        .add-question-btn {
            width: 50px;
            height: 50px;
            background-color: #2196f3;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 32px;
            cursor: pointer;
            margin: 10px auto;
            display: block;
        }

        .add-question-btn:hover {
            background-color: #1976d2;
        }

        .bottom-buttons {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }

        .bottom-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .nauka-btn {
            background-color: #9c27b0;
            color: white;
        }

        .nauka-btn:hover {
            background-color: #7b1fa2;
        }

        .egzamin-btn {
            background-color: #ff9800;
            color: white;
        }

        .egzamin-btn:hover {
            background-color: #f57c00;
        }

        .pdf-panel {
            flex: 1.5;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }

        .pdf-viewer {
            flex: 1;
            background-color: #e0e0e0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 18px;
        }
    </style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<style>
    .pdf-controls {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        padding: 16px;
        background: #f8f9fa;
        border-radius: 8px;
        margin-bottom: 16px;
        flex-wrap: wrap;
    }

    .pdf-controls button {
        padding: 8px 16px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: background 0.2s;
    }

    .pdf-controls button:hover {
        background: #0056b3;
    }

    .pdf-controls button:disabled {
        background: #ccc;
        cursor: not-allowed;
    }

    .page-info {
        color: #555;
        font-size: 14px;
        font-weight: 500;
    }

    .zoom-controls {
        display: flex;
        gap: 8px;
        align-items: center;
    }

    .pdf-viewer {
        background: #525659;
        border-radius: 8px;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 600px;
        overflow: auto;
    }

    #pdf-canvas {
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        background: white;
        display: block;
max-width: 100%;
    }

    .loading {
        color: #999;
        font-size: 16px;
    }

    .error {
        color: #dc3545;
        padding: 20px;
        text-align: center;
        background: #f8d7da;
        border-radius: 8px;
        border: 1px solid #f5c6cb;
    }
</style>


</head>
<body>
    <div class="container">
        <div class="questions-panel">
            <h2 style="margin-bottom: 20px;">Pytania</h2>
            <div class="questions-list" id="questionsList">
                <!-- Questions will be added here -->
            </div>
            <button class="add-question-btn" onclick="addQuestion()">+</button>
            <div class="bottom-buttons">
                <button class="bottom-btn nauka-btn" onclick="startNauka()">Nauka</button>
                <button class="bottom-btn egzamin-btn" onclick="startEgzamin()">Egzamin</button>
            </div>
        </div>

<div class="pdf-panel">
    <h2 style="margin-bottom: 20px;">Materiały (PDF)</h2>
    <div class="pdf-controls">
        <button id="prev-page">← Poprzednia</button>
        <span class="page-info">
            Strona <span id="page-num">-</span> / <span id="page-count">-</span>
        </span>
        <button id="next-page">Następna →</button>
        <div class="zoom-controls">
            <button id="zoom-out">−</button>
            <span class="page-info"><span id="zoom-level">75</span>%</span>
            <button id="zoom-in">+</button>
        </div>
    </div>
    <div class="pdf-viewer" id="pdf-container">
        <div class="loading">Ładowanie PDF...</div>
    </div>
</div>

<script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    let pdfDoc = null;
    let pageNum = 1;
    let pageRendering = false;
    let pageNumPending = null;
    let scale = 0.75;

    const container = document.getElementById('pdf-container');

    function renderPage(num) {
        pageRendering = true;
        
        pdfDoc.getPage(num).then(page => {
            const canvas = document.getElementById('pdf-canvas');
            const ctx = canvas.getContext('2d');
            const viewport = page.getViewport({ scale: scale });
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            const renderContext = {
                canvasContext: ctx,
                viewport: viewport
            };

            const renderTask = page.render(renderContext);

            renderTask.promise.then(() => {
                pageRendering = false;
                if (pageNumPending !== null) {
                    renderPage(pageNumPending);
                    pageNumPending = null;
                }
            });
        });

        document.getElementById('page-num').textContent = num;
    }

    function queueRenderPage(num) {
        if (pageRendering) {
            pageNumPending = num;
        } else {
            renderPage(num);
        }
    }

    function onPrevPage() {
        if (pageNum <= 1) return;
        pageNum--;
        queueRenderPage(pageNum);
        updateButtons();
    }

    function onNextPage() {
        if (pageNum >= pdfDoc.numPages) return;
        pageNum++;
        queueRenderPage(pageNum);
        updateButtons();
    }

    function updateButtons() {
        document.getElementById('prev-page').disabled = pageNum <= 1;
        document.getElementById('next-page').disabled = pageNum >= pdfDoc.numPages;
    }

    function updateZoom(delta) {
        scale += delta;
        scale = Math.max(0.5, Math.min(3, scale));
        document.getElementById('zoom-level').textContent = Math.round(scale * 100);
        queueRenderPage(pageNum);
    }

    document.getElementById('prev-page').addEventListener('click', onPrevPage);
    document.getElementById('next-page').addEventListener('click', onNextPage);
    document.getElementById('zoom-in').addEventListener('click', () => updateZoom(0.25));
    document.getElementById('zoom-out').addEventListener('click', () => updateZoom(-0.25));

    // Load the PDF
    pdfjsLib.getDocument('sql.pdf').promise.then(pdf => {
        pdfDoc = pdf;
        document.getElementById('page-count').textContent = pdf.numPages;
        
        container.innerHTML = '<canvas id="pdf-canvas"></canvas>';
        
        renderPage(pageNum);
        updateButtons();
    }).catch(err => {
        console.error('Error loading PDF:', err);
        container.innerHTML = '<div class="error">Błąd: Nie można załadować pliku sql.pdf<br>Upewnij się, że plik znajduje się w tym samym katalogu.</div>';
    });
</script>


    </div>

    <script>
        let questions = [
        //    { id: 1, text: "Jakie są podstawowe zasady programowania obiektowego?", checked: false, progress: 30 },
        //    { id: 2, text: "Co to jest zmienność w JavaScript?", checked: true, progress: 70 },
        //    { id: 3, text: "Jak działa dziedziczenie w OOP?", checked: false, progress: 50 },
        //    { id: 4, text: "Czym różni się let od var?", checked: false, progress: 90 }
        ];

//        let nextId = 5;
let nextId = 1;

async function getData() {
  const response = await fetch('http://localhost:3000/question?pdfId=' + parseInt(location.search.substr(1)));
  const data = await response.json();
  data.forEach(d => addQuestionFromServer(d));
}
getData();

        function renderQuestions() {
            const list = document.getElementById('questionsList');
            list.innerHTML = '';

            questions.forEach(q => {
                const item = document.createElement('div');
                item.className = 'question-item';
                
                item.innerHTML = `
                    <input type="checkbox" class="checkbox" ${q.checked ? 'checked' : ''} 
                           onchange="toggleCheck(${q.id})">
                    <div class="question-text" onclick="goToPage(${q.page})">${q.text}</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${q.progress}%"></div>
                    </div>
                    <button class="delete-btn" onclick="deleteQuestion(${q.id})">×</button>
                `;
                
                list.appendChild(item);
            });
        }

        function toggleCheck(id) {
            const question = questions.find(q => q.id === id);
            if (question) {
                question.checked = !question.checked;
            }
        }

        function deleteQuestion(id) {
            questions = questions.filter(q => q.id !== id);
            renderQuestions();
        }

        function addQuestion() {
            const text = prompt('Wprowadź treść pytania:');
            if (text && text.trim()) {
                questions.push({
                    id: nextId++,
                    text: text.trim(),
                    checked: false,
                    progress: 0
                });
                renderQuestions();
            }
        }

        function addQuestionFromServer(q) {
            const {text,id} = q;
            if (text && text.trim()) {
                questions.push({
                    id: parseInt(id),
                    text: text.trim(),
                    checked: false,
                    progress: 0,
                    page: q.page
                });
                renderQuestions();
            }
        }

        function startNauka() {
            const selected = questions.filter(q => q.checked);
            if (selected.length === 0) {
                alert('Zaznacz przynajmniej jedno pytanie!');
                return;
            }
            location.href = 'learn.html?' + parseInt(selected[0].id);
//            alert(`Rozpoczynam naukę z ${selected.length} pytaniami`);
        }

        function startEgzamin() {
            const selected = questions.filter(q => q.checked);
            if (selected.length === 0) {
                alert('Zaznacz przynajmniej jedno pytanie!');
                return;
            }
            alert(`Rozpoczynam egzamin z ${selected.length} pytaniami`);
        }

// Go to a specific page number
function goToPage(targetPage) {
    if (targetPage >= 1 && targetPage <= pdfDoc.numPages) {
        pageNum = targetPage;
        queueRenderPage(pageNum);
        updateButtons();
    }
}

// Go to page and scroll to a specific vertical position (0-1, where 0 is top, 1 is bottom)
function goToPageAndPosition(targetPage, verticalPosition) {
    goToPage(targetPage);
    
    // Wait for the page to render, then scroll
    setTimeout(() => {
        const canvas = document.getElementById('pdf-canvas');
        const container = document.getElementById('pdf-container');
        if (canvas) {
            const scrollTop = canvas.height * verticalPosition;
            container.scrollTop = scrollTop;
        }
    }, 100);
}


        // Initialize
        renderQuestions();
    </script>
</body>
</html>
